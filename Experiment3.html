<!doctype html>
<html>
<head>
    <title>My experiment</title>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.1/jquery.min.js"></script>
    <script src="jspsych-5.0/jspsych.js"></script>

    <!-- JS Psych Plugins -->
    <script src="jspsych-5.0/plugins/jspsych-html.js"></script>
    <script src="jspsych-5.0/plugins/jspsych-button-response.js"></script>
    <script src="js/missing-letters.js"></script>
    <script src="js/sentence-reveal.js"></script>
    <script src="js/button-response-correct.js"></script>

    <script src="http://ajax.googleapis.com/ajax/libs/jquery/1.8.2/jquery.min.js"></script>
    <script type="text/javascript"
            src="http://ajax.googleapis.com/ajax/libs/mootools/1.2.4/mootools-yui-compressed.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery-csv/0.71/jquery.csv-0.71.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/4.1.2/papaparse.min.js"></script>

    <link href="css/jspsych-mobile.css" rel="stylesheet" type="text/css"></link>
    <link href="css/experiment.css" rel="stylesheet" type="text/css"></link>

    <meta name="viewport" content="width=device-width, initial-scale=1">

</head>
<body>
  <div class="piPlayerHeader">
        <img src="/images/header-minimal.png">
  </div>
  <div id="container">
      <div id="score"/>
      <div id="jspsych-target"/>
  </div>

</body>
<script>

    function parseData(url, callBack) {
        Papa.parse(url, {
            download: true,
            dynamicTyping: true,
            header: true,
            complete: function (results) {
                callBack(results.data);
            }
        });
    }
    parseData('./scenarios/scenarios.csv', doStuff);

    // This score is incremented for every correct answer and displayed
    // to the user.
    var score = 0;

        // This is called when we complete parsing the CSV file, and will in tern build all the trials.
    function doStuff(scenarios) {

        /* create experiment timeline array */
        var timeline = [];

        // Add an introduction.
        var introduction  = {
            type:'html',
            url: "introduction.html",
            cont_btn: "start"
        };
        timeline.push(introduction);

        var vividness = {
            type: 'button-response',
            is_html: true,
            stimulus: 'How vividly did you imagine yourself in the scenario?',
            choices: ['Not at all', 'Somewhat', 'Moderately', 'Very', 'Totally'],
            correct_choice: 'Yes'
        };

        timeline.push(vividness);

        // Loop through the timeline creating scenerios
        for (var k = 0; k < 5; k++) {
            var paragraph = {
                type: 'sentence-reveal',
                paragraph: scenarios[k].Scenario
            };
            var scenario = {
                type: 'missing-letters',
                phrase: scenarios[k].PositiveS,
                letters_to_remove: 2,
                on_finish: function(trial_data){
                    if(trial_data.correct == true) score++;
                    $("#score").text("score: " + score);
                }
            };
            var question = {
                type: 'button-response-correct',
                is_html: true,
                stimulus: scenarios[k].Questions,
                choices: ['Yes', 'No'],
                correct_choice: 'Yes'
            };

            console.log(jsPsych.data);

            // Add vividness question after ...
            if(k > 0 && k%5 == 0) timeline.push(vividness);

            timeline.push(paragraph);
            timeline.push(scenario);
            timeline.push(question);
        }

        jsPsych.init({
            timeline: timeline,
            display_element: $("#jspsych-target"),
            on_finish: function (data) {
                jsPsych.data.displayData();
                //window.location.assign(contextRoot + "jspsych/completed/" + csvFile);
            }
            //saveData("DutchArticles"+SubjectID+".csv", jsPsych.data.dataAsCSV())}
        });
    }
    /*]]>*/
</script>
</html>
